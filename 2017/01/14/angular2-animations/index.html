<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8" />

  
  <title>[译][Angular2] Animations</title>

  
  




  
  <meta name="author" content="wukn" />
  <meta name="description" content=" 看一看Angular2的动画系统。
 
" />

  
  
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@gohugoio" />
    <meta name="twitter:title" content="[译][Angular2] Animations" />
    <meta name="twitter:description" content=" 看一看Angular2的动画系统。
 
" />
    <meta name="twitter:image" content="http://wukn.github.io/img/avatar.jpg" />
  




<meta name="generator" content="Hugo 0.30.2" />


<link rel="canonical" href="http://wukn.github.io/2017/01/14/angular2-animations/" />
<link rel="alternative" href="http://wukn.github.io/index.xml" title="wukn blog" type="application/atom+xml" />


<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="format-detection" content="telephone=no,email=no,adress=no" />
<meta http-equiv="Cache-Control" content="no-transform" />


<meta name="robots" content="index,follow" />
<meta name="referrer" content="origin-when-cross-origin" />







<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="wukn blog" />
<meta name="msapplication-tooltip" content="wukn blog" />
<meta name='msapplication-navbutton-color' content="#5fbf5e" />
<meta name="msapplication-TileColor" content="#5fbf5e" />
<meta name="msapplication-TileImage" content="/img/tile-image-windows.png" />
<link rel="icon" href="http://wukn.github.io/img/favicon.ico" />
<link rel="icon" type="image/png" sizes="16x16" href="http://wukn.github.io/img/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="http://wukn.github.io/img/favicon-32x32.png" />
<link rel="icon" sizes="192x192" href="http://wukn.github.io/img/touch-icon-android.png" />
<link rel="apple-touch-icon" href="http://wukn.github.io/img/touch-icon-apple.png" />
<link rel="mask-icon" href="http://wukn.github.io/img/safari-pinned-tab.svg" color="#5fbf5e" />



<link rel="stylesheet" href="//cdn.bootcss.com/video.js/6.2.8/alt/video-js-cdn.min.css" />

<link rel="stylesheet" href="http://wukn.github.io/css/bundle.css" />


  
  <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <script src="//cdn.bootcss.com/video.js/6.2.8/ie8/videojs-ie8.min.js"></script>
  <![endif]-->

<!--[if lte IE 11]>
    <script src="//cdn.bootcss.com/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->


<script src="//cdn.bootcss.com/object-fit-images/3.2.3/ofi.min.js"></script>


<script src="//cdn.bootcss.com/smooth-scroll/12.1.4/js/smooth-scroll.polyfills.min.js"></script>


</head>
  <body>
    
    <div class="suspension">
      <a title="Go to top" class="to-top is-hide"><span class="icon icon-up"></span></a>
      
        
      
    </div>
    
    
  <header class="site-header">
  <img class="avatar" src="http://wukn.github.io/img/avatar.jpg" alt="Avatar">
  
  <h2 class="title">wukn blog</h2>
  
  <p class="subtitle">~ Stay Hungry, Stay Foolish ~</p>
  <button class="menu-toggle" type="button">
    <span class="icon icon-menu"></span>
  </button>
  <nav class="site-menu collapsed">
    <h2 class="offscreen">Main Menu</h2>
    <ul class="menu-list">
      
      
      
      
        <li class="menu-item  is-active"><a href="http://wukn.github.io/">Home</a></li>
      
        <li class="menu-item "><a href="https://github.com/wukn">Works</a></li>
      
        <li class="menu-item "><a href="http://wukn.github.io/tags">Tags</a></li>
      
        <li class="menu-item "><a href="http://wukn.github.io/about/">About</a></li>
      
    </ul>
  </nav>
  <nav class="social-menu collapsed">
    <h2 class="offscreen">Social Networks</h2>
    <ul class="social-list">

      

      
      <li class="social-item">
        <a href="//github.com/wukn" title="GitHub"><span class="icon icon-github"></span></a>
      </li>

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <li class="social-item">
        <a href="http://wukn.github.io/img/wechat_qrcode.png" title="Wechat"><span class="icon icon-wechat"></span></a>
      </li>

      

      

      

      

      <li class="social-item">
        <a href="http://wukn.github.io/index.xml"><span class="icon icon-rss" title="RSS"></span></a>
      </li>

    </ul>
  </nav>
</header>

  <section class="main post-detail">
    <header class="post-header">
      <h1 class="post-title">[译][Angular2] Animations</h1>
      <p class="post-meta">@wukn · Jan 14, 2017 · 3 min read</p>
    </header>
    <article class="post-content"><blockquote>
<p>看一看Angular2的动画系统。</p>
</blockquote>

<p></p>

<p>在现代Web应用中，动画是很重要的一方面。设计良好的动画让UI不仅有趣，而且还易于使用。</p>

<p>Angular的动画系统遵循<a href="https://w3c.github.io/web-animations/">Web Animations API</a>标准。只有[]版本比较新的部分浏览器](<a href="http://caniuse.com/#feat=web-animation)才支持。老的浏览器需要[web-animations.min.js](https://github.com/web-animations/web-animations-js)。">http://caniuse.com/#feat=web-animation)才支持。老的浏览器需要[web-animations.min.js](https://github.com/web-animations/web-animations-js)。</a></p>

<h3 id="案例-在两个状态之间转换">案例：在两个状态之间转换</h3>

<p>我们可以基于模型的属性让一个元素在两种状态之间切换，就像这样：</p>

<p><img src="http://wukn.github.io/img/post/angular2/animations/animation_basic_click.gif" alt="" /></p>

<p>动画是在<code>@Component</code>的元数据内定义的。在添加动画之前需要引入一些相关的函数：</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">import</span> <span class="p">{</span>
  <span class="nx">Component</span><span class="p">,</span>
  <span class="nx">Input</span><span class="p">,</span>
  <span class="nx">trigger</span><span class="p">,</span>
  <span class="nx">state</span><span class="p">,</span>
  <span class="nx">style</span><span class="p">,</span>
  <span class="nx">transition</span><span class="p">,</span>
  <span class="nx">animate</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span></code></pre></div>
<p>有了这些以后，可以在组件的元数据中定义一个<code>heroState</code>动画触发器（animation trigger）。使用动画在<code>active</code>和<code>inactive</code>两个状态之间切换。</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">animations</span><span class="o">:</span> <span class="p">[</span>
  <span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;heroState&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="nx">state</span><span class="p">(</span><span class="s1">&#39;inactive&#39;</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span>
      <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">&#39;#eee&#39;</span><span class="p">,</span>
      <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;scale(1)&#39;</span>
    <span class="p">})),</span>
    <span class="nx">state</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span>   <span class="nx">style</span><span class="p">({</span>
      <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">&#39;#cfd8dc&#39;</span><span class="p">,</span>
      <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;scale(1.1)&#39;</span>
    <span class="p">})),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;inactive =&gt; active&#39;</span><span class="p">,</span> <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;100ms ease-in&#39;</span><span class="p">)),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;active =&gt; inactive&#39;</span><span class="p">,</span> <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;100ms ease-out&#39;</span><span class="p">))</span>
  <span class="p">])</span>
<span class="p">]</span></code></pre></div>
<p>使用<code>[@triggerName]</code>语法为元素添加动画：</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span><span class="sb">  &lt;ul&gt;
</span><span class="sb">    &lt;li *ngFor=&#34;let hero of heroes&#34;
</span><span class="sb">        [@heroState]=&#34;hero.state&#34;
</span><span class="sb">        (click)=&#34;hero.toggleState()&#34;&gt;
</span><span class="sb">      {{hero.name}}
</span><span class="sb">    &lt;/li&gt;
</span><span class="sb">  &lt;/ul&gt;
</span><span class="sb">`</span><span class="p">,</span></code></pre></div>
<p>这里为每个元素都添加了动画，属性值绑定的是表达式<code>hero.state</code>，它的值要么是<code>active</code>要么是<code>inactive</code>。</p>

<p>这样就完成了动画的添加。完整的代码如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">import</span> <span class="p">{</span>
  <span class="nx">Component</span><span class="p">,</span>
  <span class="nx">Input</span><span class="p">,</span>
  <span class="nx">trigger</span><span class="p">,</span>
  <span class="nx">state</span><span class="p">,</span>
  <span class="nx">style</span><span class="p">,</span>
  <span class="nx">transition</span><span class="p">,</span>
  <span class="nx">animate</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Heroes</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./hero.service&#39;</span><span class="p">;</span>
<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">moduleId</span><span class="o">:</span> <span class="nx">module</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;hero-list-basic&#39;</span><span class="p">,</span>
  <span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span><span class="sb">    &lt;ul&gt;
</span><span class="sb">      &lt;li *ngFor=&#34;let hero of heroes&#34;
</span><span class="sb">          [@heroState]=&#34;hero.state&#34;
</span><span class="sb">          (click)=&#34;hero.toggleState()&#34;&gt;
</span><span class="sb">        {{hero.name}}
</span><span class="sb">      &lt;/li&gt;
</span><span class="sb">    &lt;/ul&gt;
</span><span class="sb">  `</span><span class="p">,</span>
  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;hero-list.component.css&#39;</span><span class="p">],</span>
  <span class="nx">animations</span><span class="o">:</span> <span class="p">[</span>
    <span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;heroState&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">state</span><span class="p">(</span><span class="s1">&#39;inactive&#39;</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span>
        <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">&#39;#eee&#39;</span><span class="p">,</span>
        <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;scale(1)&#39;</span>
      <span class="p">})),</span>
      <span class="nx">state</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span>   <span class="nx">style</span><span class="p">({</span>
        <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">&#39;#cfd8dc&#39;</span><span class="p">,</span>
        <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;scale(1.1)&#39;</span>
      <span class="p">})),</span>
      <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;inactive =&gt; active&#39;</span><span class="p">,</span> <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;100ms ease-in&#39;</span><span class="p">)),</span>
      <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;active =&gt; inactive&#39;</span><span class="p">,</span> <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;100ms ease-out&#39;</span><span class="p">))</span>
    <span class="p">])</span>
  <span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="k">class</span> <span class="nx">HeroListBasicComponent</span> <span class="p">{</span>
  <span class="err">@</span><span class="nx">Input</span><span class="p">()</span> <span class="nx">heroes</span><span class="o">:</span> <span class="nx">Heroes</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>
<h3 id="状态和切换">状态和切换</h3>

<p>Angular的动画定义分为逻辑状态和状态之间的切换。</p>

<p>动画状态是代码中定义的一个字符串值，例如上面的<code>active</code>和<code>inactive</code>。状态的来源可以是对象的属性，也可以是一个方法计算出来的值。重要的是要能在组件的模板中读到这个值。</p>

<p>可以为动画的每个状态定义样式，当元素切换到某个状态时就使用相应的样式：</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">state</span><span class="p">(</span><span class="s1">&#39;inactive&#39;</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span>
  <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">&#39;#eee&#39;</span><span class="p">,</span>
  <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;scale(1)&#39;</span>
<span class="p">})),</span>
<span class="nx">state</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span>   <span class="nx">style</span><span class="p">({</span>
  <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">&#39;#cfd8dc&#39;</span><span class="p">,</span>
  <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;scale(1.1)&#39;</span>
<span class="p">})),</span></code></pre></div>
<p>定义完状态后就要定义状态之间的切换，每个transition控制状态之间的切换时间：</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;inactive =&gt; active&#39;</span><span class="p">,</span> <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;100ms ease-in&#39;</span><span class="p">)),</span>
<span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;active =&gt; inactive&#39;</span><span class="p">,</span> <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;100ms ease-out&#39;</span><span class="p">))</span></code></pre></div>
<p><img src="http://wukn.github.io/img/post/angular2/animations/ng_animate_transitions_inactive_active.png" alt="" /></p>

<p>如果多个transition的动画内容相同，可以将它们合并到同一个定义中：</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;inactive =&gt; active, active =&gt; inactive&#39;</span><span class="p">,</span>
 <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;100ms ease-out&#39;</span><span class="p">))</span></code></pre></div>
<p>如果两个方向的转换的动画内容相同，还可以使用简写<code>&lt;=&gt;</code>：</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;inactive &lt;=&gt; active&#39;</span><span class="p">,</span> <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;100ms ease-out&#39;</span><span class="p">))</span></code></pre></div>
<p>在动画的过程中添加样式，但是它不会覆盖元素的最终样式。可以在<code>transition</code>中以行内的方式定义中间样式。</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;inactive =&gt; active&#39;</span><span class="p">,</span> <span class="p">[</span>
  <span class="nx">style</span><span class="p">({</span>
    <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">&#39;#cfd8dc&#39;</span><span class="p">,</span>
    <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;scale(1.3)&#39;</span>
  <span class="p">}),</span>
  <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;80ms ease-in&#39;</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span>
    <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">&#39;#eee&#39;</span><span class="p">,</span>
    <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;scale(1)&#39;</span>
  <span class="p">}))</span>
<span class="p">]),</span></code></pre></div>
<h4 id="通配状态">通配状态*</h4>

<p>通配符*匹配任意的动画状态。例如：</p>

<ul>
<li><code>active =&gt; *</code>表示元素从<code>active</code>切换到任意其他状态</li>
<li><code>* =&gt; *</code>任意的状态切换</li>
</ul>

<p><img src="http://wukn.github.io/img/post/angular2/animations/ng_animate_transitions_inactive_active_wildcards.png" alt="" /></p>

<h4 id="void状态">void状态</h4>

<p>有个特殊的状态<code>void</code>可以用于动画中。它表示元素没有在视图中这种状态，可能是它还没有添加到视图中，也可能是它已经被移除了。void状态对定义进入和离开动画很有用。</p>

<p>例如，<code>* =&gt; void</code>动画会在元素离开视图的时候起作用。</p>

<p><img src="http://wukn.github.io/img/post/angular2/animations/ng_animate_transitions_void_in.png" alt="" /></p>

<p>通配符*也会匹配void状态。</p>

<h3 id="案例-进入和离开动画">案例：进入和离开动画</h3>

<p>使用<code>void</code>和<code>*</code>可以定义元素进入和离开的动画。进入为<code>void =&gt; *</code>，离开为<code>* =&gt; void</code>。</p>

<p><img src="http://wukn.github.io/img/post/angular2/animations/animation_enter_leave.gif" alt="" /></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">animations</span><span class="o">:</span> <span class="p">[</span>
  <span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;flyInOut&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="nx">state</span><span class="p">(</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span><span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(0)&#39;</span><span class="p">})),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;void =&gt; *&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">style</span><span class="p">({</span><span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(-100%)&#39;</span><span class="p">}),</span>
      <span class="nx">animate</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="p">]),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;* =&gt; void&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">animate</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span><span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(100%)&#39;</span><span class="p">}))</span>
    <span class="p">])</span>
  <span class="p">])</span>
<span class="p">]</span></code></pre></div>
<p>注意上面void状态的样式是直接在transition中定义的，而不是单独定义一个<code>state(void)</code>。这样，进入和离开的动画就不一样，从左边进入，从右边离开。</p>

<p>这两种常见的动画有个别名：</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;:enter&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="p">...</span> <span class="p">]);</span> <span class="c1">// void =&gt; *
</span><span class="c1"></span><span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;:leave&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="p">...</span> <span class="p">]);</span> <span class="err">// * =&gt; void</span></code></pre></div>
<h3 id="案例-从不同的状态进入和离开">案例：从不同的状态进入和离开</h3>

<p>结合之前的状态可以定义不同状态的元素的进入和离开动画。</p>

<ul>
<li>Inactive hero enter: <code>void =&gt; inactive</code></li>
<li>Active hero enter: <code>void =&gt; active</code></li>
<li>Inactive hero leave: <code>inactive =&gt; void</code></li>
<li>Active hero leave: <code>active =&gt; void</code></li>
</ul>

<p><img src="http://wukn.github.io/img/post/angular2/animations/animation_enter_leave_states.gif" alt="" /></p>

<p>这样我们可以设计出更精细的动画：</p>

<p><img src="http://wukn.github.io/img/post/angular2/animations/ng_animate_transitions_inactive_active_void.png" alt="" /></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">animations</span><span class="o">:</span> <span class="p">[</span>
  <span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;heroState&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="nx">state</span><span class="p">(</span><span class="s1">&#39;inactive&#39;</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span><span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(0) scale(1)&#39;</span><span class="p">})),</span>
    <span class="nx">state</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span>   <span class="nx">style</span><span class="p">({</span><span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(0) scale(1.1)&#39;</span><span class="p">})),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;inactive =&gt; active&#39;</span><span class="p">,</span> <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;100ms ease-in&#39;</span><span class="p">)),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;active =&gt; inactive&#39;</span><span class="p">,</span> <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;100ms ease-out&#39;</span><span class="p">)),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;void =&gt; inactive&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">style</span><span class="p">({</span><span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(-100%) scale(1)&#39;</span><span class="p">}),</span>
      <span class="nx">animate</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="p">]),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;inactive =&gt; void&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">animate</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span><span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(100%) scale(1)&#39;</span><span class="p">}))</span>
    <span class="p">]),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;void =&gt; active&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">style</span><span class="p">({</span><span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(0) scale(0)&#39;</span><span class="p">}),</span>
      <span class="nx">animate</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="p">]),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;active =&gt; void&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">animate</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span><span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(0) scale(0)&#39;</span><span class="p">}))</span>
    <span class="p">])</span>
  <span class="p">])</span>
<span class="p">]</span></code></pre></div>
<h3 id="可作为动画的属性和单位">可作为动画的属性和单位</h3>

<p>由于Angular的动画是基于Web Animations的，我们可以使用任何浏览器认为可作为动画（animatable）的属性。这包括位置、大小、转换、颜色、边框、等等。W3C维护了一个<a href="https://www.w3.org/TR/css3-transitions/#animatable-properties">可作为动画的属性</a>列表。</p>

<p>例如，拥有数字值的位置属性，可以使用包含值和单位的字符串，如<code>50px</code>、<code>3em</code>、<code>100%</code>。如果没有单位，那么Angular默认为<code>px</code>。</p>

<h3 id="自动属性计算">自动属性计算</h3>

<p>有时候一些样式的坐标属性值直到运行的时候才能够知道。例如元素根据它的内容和屏幕的大小决定它的宽度和高度。</p>

<p><img src="http://wukn.github.io/img/post/angular2/animations/animation_auto.gif" alt="" /></p>

<p>这种情况下可以使用特殊的<code>*</code>属性值，这样就是在运行时计算出这个属性值并添加到动画中。</p>

<p>上面图片这个例子中，元素离开的动画，不管在离开之前元素的高度是多少，都从那个高度切换到0。</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">animations</span><span class="o">:</span> <span class="p">[</span>
  <span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;shrinkOut&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="nx">state</span><span class="p">(</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span><span class="nx">height</span><span class="o">:</span> <span class="s1">&#39;*&#39;</span><span class="p">})),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;* =&gt; void&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">style</span><span class="p">({</span><span class="nx">height</span><span class="o">:</span> <span class="s1">&#39;*&#39;</span><span class="p">}),</span>
      <span class="nx">animate</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span><span class="nx">height</span><span class="o">:</span> <span class="mi">0</span><span class="p">}))</span>
    <span class="p">])</span>
  <span class="p">])</span>
<span class="p">]</span></code></pre></div>
<h3 id="动画的定时">动画的定时</h3>

<p>每个transition可以定义三种时间属性，持续时间（duration）、延迟时间（delay）和缓冲函数（easing function）。它们是在一个transition的定时字符串中。</p>

<h4 id="持续时间">持续时间</h4>

<p>持续时间控制动画从开始到结束的时长。有三种定义方式：</p>

<ul>
<li>纯数字，以毫秒为单位：<code>100</code></li>
<li>以毫秒为单位的字符串：<code>'100ms'</code></li>
<li>以秒为单位的字符串：<code>'0.1s'</code></li>
</ul>

<h4 id="延迟时间">延迟时间</h4>

<p>延迟时间控制从动画触发到动画开始的时长。可以加在定义持续时间的字符串后面，格式和持续时间一样。</p>

<ul>
<li>等待100ms然后持续200ms：<code>'0.2s 100ms'</code></li>
</ul>

<h4 id="缓冲">缓冲</h4>

<p><a href="http://easings.net/">擦除函数</a>控制动画运行时候的加速和减速。例如<code>ease-in</code>，会让动画在开始的时候比较慢，然后逐渐加速。可以将它作为第三个值放在持续时间和延迟时间后面，如果没有延迟时间，那就把它放在第二个值。</p>

<ul>
<li>延迟100ms，然后运行200ms，带缓冲：<code>'0.2s 100ms ease-out'</code></li>
<li>运行200ms，带缓冲：<code>'0.2s ease-in-out'</code></li>
</ul>

<h4 id="案例">案例</h4>

<p>下面这个例子中，进入和离开动画的持续时间都是200ms，但是缓冲特效不一样。</p>

<p><img src="http://wukn.github.io/img/post/angular2/animations/animation_timings.gif" alt="" /></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">animations</span><span class="o">:</span> <span class="p">[</span>
  <span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;flyInOut&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="nx">state</span><span class="p">(</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(0)&#39;</span><span class="p">})),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;void =&gt; *&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">style</span><span class="p">({</span>
        <span class="nx">opacity</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(-100%)&#39;</span>
      <span class="p">}),</span>
      <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;0.2s ease-in&#39;</span><span class="p">)</span>
    <span class="p">]),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;* =&gt; void&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;0.2s 10 ease-out&#39;</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span>
        <span class="nx">opacity</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(100%)&#39;</span>
      <span class="p">}))</span>
    <span class="p">])</span>
  <span class="p">])</span>
<span class="p">]</span></code></pre></div>
<h3 id="多步骤动画">多步骤动画</h3>

<p>动画关键帧（keyframes）将一个简单的切换变成了有一个或多个中间样式的复杂的动画。</p>

<p>对于每个关键帧，制定一个偏移量（offset）制定在哪个点应用关键帧。offset的值介于0和1之间。0就是动画的开始，1就是动画的结束。</p>

<p>例如，使用关键帧为进入和离开动画添加弹跳效果。</p>

<p><img src="http://wukn.github.io/img/post/angular2/animations/animation_multistep.gif" alt="" /></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">animations</span><span class="o">:</span> <span class="p">[</span>
  <span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;flyInOut&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="nx">state</span><span class="p">(</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span><span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(0)&#39;</span><span class="p">})),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;void =&gt; *&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">animate</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="nx">keyframes</span><span class="p">([</span>
        <span class="nx">style</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(-100%)&#39;</span><span class="p">,</span> <span class="nx">offset</span><span class="o">:</span> <span class="mi">0</span><span class="p">}),</span>
        <span class="nx">style</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(15px)&#39;</span><span class="p">,</span>  <span class="nx">offset</span><span class="o">:</span> <span class="mf">0.3</span><span class="p">}),</span>
        <span class="nx">style</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(0)&#39;</span><span class="p">,</span>     <span class="nx">offset</span><span class="o">:</span> <span class="mf">1.0</span><span class="p">})</span>
      <span class="p">]))</span>
    <span class="p">]),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;* =&gt; void&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">animate</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="nx">keyframes</span><span class="p">([</span>
        <span class="nx">style</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(0)&#39;</span><span class="p">,</span>     <span class="nx">offset</span><span class="o">:</span> <span class="mi">0</span><span class="p">}),</span>
        <span class="nx">style</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(-15px)&#39;</span><span class="p">,</span> <span class="nx">offset</span><span class="o">:</span> <span class="mf">0.7</span><span class="p">}),</span>
        <span class="nx">style</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(100%)&#39;</span><span class="p">,</span>  <span class="nx">offset</span><span class="o">:</span> <span class="mf">1.0</span><span class="p">})</span>
      <span class="p">]))</span>
    <span class="p">])</span>
  <span class="p">])</span>
<span class="p">]</span></code></pre></div>
<p>关键帧的offset参数可以忽略。如果忽略那么就是每个关键帧之间时间间隔相等。例如，三个没有offset的关键帧将会接收到0、0.5和1作为offset。</p>

<h3 id="并行动画组">并行动画组</h3>

<p>前面看到过怎样在同一个时刻添加多个样式属性，就是将它们放到同一个<code>style()</code>中。</p>

<p>也许你想为一个动画添加并行作用的不同的定时效果。例如，你想用两个CSS属性做动画，但是每个使用不同的缓冲函数。</p>

<p>这种场景可以使用动画组（group）。例如，为进入和离开动画使用两个不同的定时效果，它们会并行的作用在同一个元素上，但是是分开执行的。</p>

<p><img src="http://wukn.github.io/img/post/angular2/animations/animation_groups.gif" alt="" /></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">animations</span><span class="o">:</span> <span class="p">[</span>
  <span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;flyInOut&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="nx">state</span><span class="p">(</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span><span class="nx">width</span><span class="o">:</span> <span class="mi">120</span><span class="p">,</span> <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(0)&#39;</span><span class="p">,</span> <span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span><span class="p">})),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;void =&gt; *&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">style</span><span class="p">({</span><span class="nx">width</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span> <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(50px)&#39;</span><span class="p">,</span> <span class="nx">opacity</span><span class="o">:</span> <span class="mi">0</span><span class="p">}),</span>
      <span class="nx">group</span><span class="p">([</span>
        <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;0.3s 0.1s ease&#39;</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span>
          <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(0)&#39;</span><span class="p">,</span>
          <span class="nx">width</span><span class="o">:</span> <span class="mi">120</span>
        <span class="p">})),</span>
        <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;0.3s ease&#39;</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span>
          <span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span>
        <span class="p">}))</span>
      <span class="p">])</span>
    <span class="p">]),</span>
    <span class="nx">transition</span><span class="p">(</span><span class="s1">&#39;* =&gt; void&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">group</span><span class="p">([</span>
        <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;0.3s ease&#39;</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span>
          <span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;translateX(50px)&#39;</span><span class="p">,</span>
          <span class="nx">width</span><span class="o">:</span> <span class="mi">10</span>
        <span class="p">})),</span>
        <span class="nx">animate</span><span class="p">(</span><span class="s1">&#39;0.3s 0.2s ease&#39;</span><span class="p">,</span> <span class="nx">style</span><span class="p">({</span>
          <span class="nx">opacity</span><span class="o">:</span> <span class="mi">0</span>
        <span class="p">}))</span>
      <span class="p">])</span>
    <span class="p">])</span>
  <span class="p">])</span>
<span class="p">]</span></code></pre></div>
<p>一个组作用于元素的转换和宽度，另一个组作用于调整元素的透明度。</p>

<h3 id="动画回调">动画回调</h3>

<p>动画开始和结束的时候会触发回调。</p>

<p>在关键帧那个例子中，我们可以有一个名为<code>@flyInOut</code>的触发器。可以这样添加回调函数：</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span><span class="sb">  &lt;ul&gt;
</span><span class="sb">    &lt;li *ngFor=&#34;let hero of heroes&#34;
</span><span class="sb">        (@flyInOut.start)=&#34;animationStarted($event)&#34;
</span><span class="sb">        (@flyInOut.done)=&#34;animationDone($event)&#34;
</span><span class="sb">        [@flyInOut]=&#34;&#39;in&#39;&#34;&gt;
</span><span class="sb">      {{hero.name}}
</span><span class="sb">    &lt;/li&gt;
</span><span class="sb">  &lt;/ul&gt;
</span><span class="sb">`</span><span class="p">,</span></code></pre></div>
<p>回调函数接受一个<code>AnimationTransitionEvent</code>，它包含一些有用的属性，如<code>fromState</code>、<code>toState</code>和<code>totalTime</code>。</p>

<p>Those callbacks will fire whether or not an animation is picked up.</p>

<hr />

<p>参考资料：</p>

<p><a href="https://angular.io/docs/ts/latest/guide/animations.html">Angular2 Documentation - Animations</a></p></article>
    <footer class="post-footer">
      
      <ul class="post-tags">
        
          <li><a href="http://wukn.github.io/tags/angular2"><span class="tag">Angular2</span></a></li>
        
      </ul>
      
      <p class="post-copyright">
        © Creative Commons Attribution-NonCommercial 4.0 International License.This post was published <strong>285</strong> days ago, content in the post may be inaccurate, even wrong now, please take risk yourself.
      </p>
    </footer>
    
      
    
  </section>
  <footer class="site-footer">
  <p>© 2017 wukn blog</p>
  <p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with theme <a href="https://github.com/laozhu/hugo-nuo" target="_blank">Nuo</a>.</p>
  
</footer>



<script async src="//cdn.bootcss.com/video.js/6.2.8/alt/video.novtt.min.js"></script>


<script src="http://wukn.github.io/js/bundle.js"></script>


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-XXXXXXXX-X', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>





  </body>
</html>
